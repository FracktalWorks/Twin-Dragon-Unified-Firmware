[gcode_macro CALIBRATE_ALL]
description: Calibrate PID for T0, T1 (if present), Bed, and Run Shaper Calibration
gcode:
    G28
    G0 X100 Y100 Z100 F2000
    {% set extruders = printer.configfile.config["heater_fan hotend_fan"].keys() if "extruder1" in printer.configfile.config else [] %}
    # PID tune T0
    M117 PID Tuning T0
    PID_CALIBRATE HEATER=extruder TARGET=240

    # Wait for T0 to finish PID calibration
    {% if printer["extruder"].pid_Kp is not none %}
        M117 T0 PID Done
    {% else %}
        M117 T0 PID Failed or Incomplete
    {% endif %}

    # PID tune T1 if available
    {% if "extruder1" in printer %}
        M117 PID Tuning T1
        PID_CALIBRATE HEATER=extruder1 TARGET=240

        # Wait for T1 to finish PID calibration
        {% if printer["extruder1"].pid_Kp is not none %}
            M117 T1 PID Done
        {% else %}
            M117 T1 PID Failed or Incomplete
        {% endif %}
    {% endif %}

    # PID tune Bed
    M117 PID Tuning Bed
    PID_CALIBRATE HEATER=heater_bed TARGET=70

    {% if printer["heater_bed"].pid_Kp is not none %}
        M117 Bed PID Done
    {% else %}
        M117 Bed PID Failed or Incomplete
    {% endif %}

    # Shaper Calibration
    M117 Starting Shaper Calibration
    G28
    SHAPER_CALIBRATE

    M117 All Calibration Commands Sent
